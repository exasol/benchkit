title: "Exasol vs ClickHouse vs Trino Performance Comparison on TPC-H SF30 (Multi-Node Multi-User)"
author: "Benchmark Team"

# Execution configuration
execution:
  parallel: true          # Enable parallel execution of systems
  max_workers: 3          # Max concurrent systems

env:
  mode: "aws"
  region: "eu-west-1"
  allow_external_database_access: true
  instances:
    # Smaller instances per node for 3-node clusters
    # Total: 3 nodes × 4 vCPUs = 12 vCPUs, 3 × 32GB = 96GB per system
    exasol:
      instance_type: "r5d.xlarge"   # 4 vCPUs, 32GB RAM, 1x300GB NVMe per node
      disk:
        type: "local"
      label: "ok-bench-exa-mn-mu"
    clickhouse:
      instance_type: "r5d.xlarge"   # 4 vCPUs, 32GB RAM, 1x300GB NVMe per node
      disk:
        type: "local"
      label: "ok-bench-ch-mn-mu"
    trino:
      instance_type: "r5d.xlarge"   # 4 vCPUs, 32GB RAM, 1x300GB NVMe per node
      disk:
        type: "local"
      label: "ok-bench-trino-mn-mu"
  os_image: "ubuntu-22.04"
  ssh_key_name: "ok-work3"
  ssh_private_key_path: "~/.ssh/ok-work3.pem"

systems:
  # Exasol - 3-node cluster
  - name: "exasol"
    kind: "exasol"
    version: "2025.1.8"
    setup:
      method: "installer"
      node_count: 3                 # 3-node cluster
      use_additional_disk: true
      c4_version: "4.28.5"
      host_addrs: "$EXASOL_PRIVATE_IP"
      host_external_addrs: "$EXASOL_PUBLIC_IP"
      image_password: "exasol123"
      db_password: "exasol456"
      admin_password: "exasol789"
      license_file: "configs/exasol.license"
      db_mem_size: 72000            # 24GB × 3 nodes = 72GB cluster memory
      extra:
        optimizer_mode: "analytical"
        db_params:
          - "-writeTouchInit=1"
          - "-cacheMonitorLimit=0"
          - "-maxOverallSlbUsageRatio=0.95"
          - "-useQueryCache=0"
          - "-query_log_timeout=0"
          - "-joinOrderMethod=0"
          - "-etlCheckCertsDefault=0"

  # ClickHouse - 3-node sharded cluster
  - name: "clickhouse"
    kind: "clickhouse"
    version: "25.10.2.65"
    setup:
      method: "native"
      node_count: 3                 # 3-node sharded cluster
      use_additional_disk: true
      data_dir: "/data/clickhouse"
      host: "$CLICKHOUSE_PUBLIC_IP"
      port: 8123
      username: "default"
      password: "clickhouse123"
      extra:
        memory_limit: "24g"                      # Per-node memory limit (32GB instance - OS overhead)
        max_threads: "4"                         # Match per-node vCPUs
        # Per-query limits adjusted for 5 concurrent streams on smaller nodes
        max_memory_usage: "4000000000"           # ~4GB per query
        max_bytes_before_external_group_by: "2000000000"
        max_bytes_before_external_sort: "2000000000"
        join_algorithm: "grace_hash"             # Spill joins to disk when memory exceeded
        max_bytes_in_join: "1000000000"          # 1GB before spilling to disk

  # Trino - 3-node cluster (1 coordinator + 2 workers)
  - name: "trino"
    kind: "trino"
    version: "447"
    setup:
      method: "native"
      node_count: 3                 # 3-node cluster: 1 coordinator + 2 workers
      use_additional_disk: true
      host: "$TRINO_PUBLIC_IP"
      port: 8080
      username: "admin"
      catalog: "hive"
      schema: "benchmark"
      catalogs: ["memory", "hive"]
      # S3 storage required for multinode Trino (bucket auto-created if needed)
      storage:
        type: "s3"
        bucket: "benchkit-trino-mn-eu-west-1"
        region: "eu-west-1"
      extra:
        # Cluster-wide and per-node memory limits for smaller instances
        query_max_memory: "60GB"            # Total across cluster
        query_max_memory_per_node: "24GB"   # Per-node limit (~75% of 32GB)

workload:
  name: "tpch"
  scale_factor: 30        # 30GB dataset
  runs_per_query: 7
  warmup_runs: 1
  data_format: "csv"
  generator: "dbgen"
  # Use tuned queries for ClickHouse multinode (avoids correlated subqueries)
  system_variants:
    clickhouse: "tuned"
  # Multi-user concurrent execution
  multiuser:
    enabled: true
    num_streams: 5        # 5 concurrent query streams
    randomize: true       # Randomize query order across streams
    random_seed: 42       # Fixed seed for reproducibility

report:
  show_boxplots: true
  show_latency_cdf: true
  show_bar_chart: true
  show_heatmap: true

{
  "system_name": "clickhouse",
  "system_kind": "clickhouse",
  "system_version": "25.9.3.48",
  "commands": {
    "storage_setup": [
      {
        "command": "sudo mdadm --stop /dev/md0 2>/dev/null || true",
        "success": true,
        "description": "Stop existing RAID array at /dev/md0 if present",
        "category": "storage_setup"
      },
      {
        "command": "sudo mdadm --stop /dev/md0 2>/dev/null || true",
        "success": true,
        "description": "Execute sudo command on remote system",
        "category": "storage_setup"
      },
      {
        "command": "sudo mdadm --zero-superblock /dev/nvme1n1 2>/dev/null || true",
        "success": true,
        "description": "Clear RAID superblock on /dev/nvme1n1",
        "category": "storage_setup"
      },
      {
        "command": "sudo mdadm --zero-superblock /dev/nvme1n1 2>/dev/null || true",
        "success": true,
        "description": "Execute sudo command on remote system",
        "category": "storage_setup"
      },
      {
        "command": "sudo mdadm --zero-superblock /dev/nvme2n1 2>/dev/null || true",
        "success": true,
        "description": "Clear RAID superblock on /dev/nvme2n1",
        "category": "storage_setup"
      },
      {
        "command": "sudo mdadm --zero-superblock /dev/nvme2n1 2>/dev/null || true",
        "success": true,
        "description": "Execute sudo command on remote system",
        "category": "storage_setup"
      },
      {
        "command": "yes | sudo mdadm --create /dev/md0 --level=0 --raid-devices=2 /dev/nvme1n1 /dev/nvme2n1",
        "success": true,
        "description": "Create RAID0 array from 2 devices",
        "category": "storage_setup"
      },
      {
        "command": "yes | sudo mdadm --create /dev/md0 --level=0 --raid-devices=2 /dev/nvme1n1 /dev/nvme2n1",
        "success": true,
        "description": "Execute yes command on remote system",
        "category": "storage_setup"
      },
      {
        "command": "sudo mdadm --wait /dev/md0 2>/dev/null || true",
        "success": true,
        "description": "Wait for RAID array /dev/md0 to be ready",
        "category": "storage_setup"
      },
      {
        "command": "sudo mdadm --wait /dev/md0 2>/dev/null || true",
        "success": true,
        "description": "Execute sudo command on remote system",
        "category": "storage_setup"
      },
      {
        "command": "sudo mkdir -p /etc/mdadm",
        "success": true,
        "description": "Create mdadm configuration directory",
        "category": "storage_setup"
      },
      {
        "command": "sudo mkdir -p /etc/mdadm",
        "success": true,
        "description": "Execute sudo command on remote system",
        "category": "storage_setup"
      },
      {
        "command": "sudo mdadm --detail --scan | sudo tee -a /etc/mdadm/mdadm.conf",
        "success": true,
        "description": "Save RAID configuration",
        "category": "storage_setup"
      },
      {
        "command": "sudo mdadm --detail --scan | sudo tee -a /etc/mdadm/mdadm.conf",
        "success": true,
        "description": "Execute sudo command on remote system",
        "category": "storage_setup"
      },
      {
        "command": "sudo mkfs.ext4 -F /dev/md0",
        "success": true,
        "description": "Format /dev/md0 with ext4 filesystem",
        "category": "storage_setup"
      },
      {
        "command": "sudo mkfs.ext4 -F /dev/md0",
        "success": true,
        "description": "Execute sudo command on remote system",
        "category": "storage_setup"
      },
      {
        "command": "sudo mkdir -p /data",
        "success": true,
        "description": "Create mount point /data",
        "category": "storage_setup"
      },
      {
        "command": "sudo mkdir -p /data",
        "success": true,
        "description": "Execute sudo command on remote system",
        "category": "storage_setup"
      },
      {
        "command": "sudo mount /dev/md0 /data",
        "success": true,
        "description": "Mount /dev/md0 to /data",
        "category": "storage_setup"
      },
      {
        "command": "sudo mount /dev/md0 /data",
        "success": true,
        "description": "Execute sudo command on remote system",
        "category": "storage_setup"
      },
      {
        "command": "sudo chown -R ubuntu:ubuntu /data",
        "success": true,
        "description": "Set ownership of /data to ubuntu:ubuntu",
        "category": "storage_setup"
      },
      {
        "command": "sudo chown -R ubuntu:ubuntu /data",
        "success": true,
        "description": "Execute sudo command on remote system",
        "category": "storage_setup"
      },
      {
        "command": "sudo mkdir -p /data/clickhouse",
        "success": true,
        "description": "Create ClickHouse data directory under /data",
        "category": "storage_setup"
      },
      {
        "command": "sudo mkdir -p /data/clickhouse",
        "success": true,
        "description": "Execute sudo command on remote system",
        "category": "storage_setup"
      },
      {
        "command": "sudo chown -R clickhouse:clickhouse /data/clickhouse",
        "success": true,
        "description": "Set ownership of /data/clickhouse to clickhouse:clickhouse",
        "category": "storage_setup"
      }
    ],
    "prerequisites": [
      {
        "command": "sudo apt-get update",
        "success": true,
        "description": "Update package lists",
        "category": "prerequisites"
      },
      {
        "command": "sudo apt-get install -y apt-transport-https ca-certificates curl gnupg",
        "success": true,
        "description": "Install prerequisite packages for secure repository access",
        "category": "prerequisites"
      }
    ],
    "repository_setup": [
      {
        "command": "curl -fsSL 'https://packages.clickhouse.com/rpm/lts/repodata/repomd.xml.key' | sudo gpg --dearmor -o /usr/share/keyrings/clickhouse-keyring.gpg",
        "success": true,
        "description": "Add ClickHouse GPG key to system keyring",
        "category": "repository_setup"
      },
      {
        "command": "ARCH=$(dpkg --print-architecture) && echo \"deb [signed-by=/usr/share/keyrings/clickhouse-keyring.gpg arch=${ARCH}] https://packages.clickhouse.com/deb stable main\" | sudo tee /etc/apt/sources.list.d/clickhouse.list",
        "success": true,
        "description": "Add ClickHouse official repository to APT sources",
        "category": "repository_setup"
      },
      {
        "command": "sudo apt-get update",
        "success": true,
        "description": "Update package lists with ClickHouse repository",
        "category": "repository_setup"
      }
    ],
    "installation": [
      {
        "command": "sudo apt-get install -y clickhouse-server=25.9.3.48 clickhouse-client=25.9.3.48",
        "success": true,
        "description": "Install ClickHouse server and client version <PUBLIC_IP>",
        "category": "installation"
      }
    ],
    "configuration": [
      {
        "command": "sudo tee /etc/clickhouse-server/config.d/benchmark.xml > /dev/null << 'EOF'\n<clickhouse>\n    <listen_host>::</listen_host>\n    <path>/data/clickhouse</path>\n    <max_server_memory_usage>106897745510</max_server_memory_usage>\n    <max_concurrent_queries>8</max_concurrent_queries>\n    <background_pool_size>16</background_pool_size>\n    <background_schedule_pool_size>16</background_schedule_pool_size>\n    <max_table_size_to_drop>50000000000</max_table_size_to_drop>\n</clickhouse>\nEOF",
        "success": true,
        "description": "Create custom ClickHouse configuration file",
        "category": "configuration"
      }
    ],
    "user_configuration": [
      {
        "command": "sudo tee /etc/clickhouse-server/users.d/benchmark.xml > /dev/null << 'EOF'\n<clickhouse>\n    <users>\n        <default replace=\"true\">\n            <password_sha256_hex>2cca9d8714615f4132390a3db9296d39ec051b3faff87be7ea5f7fe0e2de14c9</password_sha256_hex>\n            <networks>\n                <ip>::/0</ip>\n            </networks>\n        </default>\n    </users>\n    <profiles>\n        <default>\n            <max_threads>16</max_threads>\n            <max_memory_usage>30000000000</max_memory_usage>\n            <max_bytes_before_external_sort>73492200038</max_bytes_before_external_sort>\n            <max_bytes_before_external_group_by>73492200038</max_bytes_before_external_group_by>\n            <join_use_nulls>1</join_use_nulls>\n            <allow_experimental_correlated_subqueries>1</allow_experimental_correlated_subqueries>\n            <optimize_read_in_order>1</optimize_read_in_order>\n            <max_insert_threads>8</max_insert_threads>\n        </default>\n    </profiles>\n</clickhouse>\nEOF",
        "success": true,
        "description": "Configure ClickHouse user profile with password and query settings",
        "category": "user_configuration"
      }
    ],
    "service_management": [
      {
        "command": "sudo systemctl start clickhouse-server",
        "success": true,
        "description": "Start ClickHouse server service",
        "category": "service_management"
      },
      {
        "command": "sudo systemctl enable clickhouse-server",
        "success": true,
        "description": "Enable ClickHouse server to start on boot",
        "category": "service_management"
      }
    ]
  },
  "installation_notes": [
    "RAID0 array created: /dev/md0 from 2 devices",
    "Storage device /dev/md0 mounted at /data",
    "ClickHouse data directory: /data/clickhouse",
    "Installing ClickHouse using official APT repository",
    "ClickHouse configuration file created: /etc/clickhouse-server/config.d/benchmark.xml",
    "ClickHouse user profile configured with optimized settings",
    "Waiting for ClickHouse server to be ready for connections...",
    "ClickHouse server is ready and accepting connections",
    "ClickHouse configuration applied:",
    "  Hardware-detected settings (CPU cores: 16, RAM: 124.4GB)",
    "  max_threads: 16",
    "  max_memory_usage: 30.0GB",
    "  max_bytes_before_external_sort: 73.5GB",
    "  max_bytes_before_external_group_by: 73.5GB",
    "  max_server_memory_usage: 106.9GB",
    "  max_concurrent_queries: 8",
    "  background_pool_size: 16",
    "  background_schedule_pool_size: 16",
    "  max_table_size_to_drop: 50.0GB"
  ],
  "config_parameters": {
    "use_additional_disk": true,
    "data_dir": "/data/clickhouse",
    "host": "<PUBLIC_IP>",
    "port": 8123,
    "username": "default",
    "password": "<DATABASE_PASSWORD>",
    "extra": {
      "memory_limit": "32g",
      "max_threads": "16",
      "max_memory_usage": "30000000000"
    }
  },
  "data_directory": "/data/clickhouse"
}